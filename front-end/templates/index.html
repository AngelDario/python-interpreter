<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description"
        content="Build and Run your Python code instantly. Online-Python is a quick and easy tool that helps you to build, compile, test your python programs.">
    <meta name="keywords"
        content="online python compiler, online python ide, online python interpreter, python online interpreter, online python editor, online python 3, online python code runner, run python script online, online python code editor, online python syntax checker, online python with numpy, online python text editor, python online ide free, online python editor free">
    <meta name="author" content="online-python">
    <meta name="copyright" content="ShareAlike">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <title>Collaborative python interpreter</title>

    <!-- Stylesheets -->
    <link rel="stylesheet"
        href="https://www.online-python.com/assets/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
    <link rel="stylesheet" href="https://www.online-python.com/assets/dist/css/ide.css?v=a1">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css">

    <!-- JavaScript -->
    <script src="https://www.online-python.com/assets/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="https://www.online-python.com/assets/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8/ace.js" type="text/javascript"
        charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8/ext-language_tools.min.js" type="text/javascript"
        charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8/ext-settings_menu.min.js" type="text/javascript"
        charset="utf-8"></script>
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8/ext-keybinding_menu.min.js"
        type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.2/split.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
        integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
        crossorigin="anonymous"></script>
    <script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <style>
        .dark-theme {
            background-color: black;
            color: white;
        }

        .light-theme {
            background-color: transparent;
            color: black;
        }
    </style>
</head>

<body>
    <div>

        <div class="container" id="container">

            <div id="header-control" class="col-12">
                <div class="btn-group">
                    <!-- Botones para Ruby, PHP y JavaScript -->
                    <button type="button" class="btn btn-success btn-custom" onclick="runCode()" data-toggle="popover"
                        data-placement="bottom" data-trigger="hover" data-content="F8"><i
                            class="fa fa-play"></i>&ensp;<strong>Run</strong></button>
                </div>

            </div>

            <!--Primera Fila-->
            <div class="row container" style="padding-top: 30px; height: 400px; min-height: 0px;">
                <!--Editor-->
                <div id="mi" class="col-12 col-lg-5"
                    style="height: 300px; padding-right: 0%; padding-left: 0%; width: 500px;">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="active" id="editor-1"><a id="main-id">main.py</a></li>
                    </ul>

                    <div id="editor"></div>
                    <div class="boxed" id="editor_footer"></div>

                </div>
                <!--Editor Info-->
                <div class="col-lg-5">
                    <h3>Front-end</h3>
                    <div id="conexion-detalles">
                        <p><strong>Name:</strong> <span id="conexion-hostname">{{server_info.hostname}}</span></p>
                        <p><strong>IP:</strong> {{host_ip}}</p>
                    </div>
                </div>
            </div>

            <!--Segunda Fila-->
            <div class="row container" style=" padding-top: 50px; height: 500px; min-height: 0px;">
                <!--Terminal-->
                <div id="d" class="col-12 col-lg-5"
                    style="height: 300px; padding-right: 0%; padding-left: 0%; width: 500px;">

                    <div id="terminal" style="border-bottom-right-radius: 0px;">
                        <div id="progress-status"></div>
                        <div class="boxed2" id="output" style="display: block; ">
                            <div class="wrapper" id="wrap">
                            </div>
                        </div>

                        <div id="terminal-ad">
                        </div>
                    </div>
                </div>
                <!--Terminal Info-->
                <div class="col-lg-5">
                    <h3>Back-end</h3>
                    <div id="solicitud-detalles">
                        <p><strong>Name:</strong> <span id="solicitud-hostname"></span></p>
                        <p><strong>IP:</strong><span id="solicitud-ip"></span></p>
                    </div>
                </div>
            </div>
        </div>

    </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script type="text/javascript">

        // Connect to the Socket.IO server
        const socket = io.connect();

        // Initialize ACE editor
        const editor = ace.edit("editor");
        editor.getSession().setMode("ace/mode/plain_text");

        // Flag to track if change is user initiated
        let userTyping = false;

        // Send text updates to the server
        editor.getSession().on('change', function (delta) {
            if (userTyping) {
                socket.emit('text_update', editor.getValue());
            }
        });

        // Receive text updates from the server
        socket.on('text_update', function (data) {
            // Get cursor position and selection
            const selection = editor.getSelection();
            const cursorPosition = editor.getCursorPosition();

            // Update flag
            userTyping = false;

            // Update editor value
            editor.setValue(data);

            // Restore cursor position and selection
            editor.moveCursorToPosition(cursorPosition);
            editor.clearSelection();
            editor.getSelection().addRange(selection);
        });

        // Track user typing
        editor.on("input", function () {
            userTyping = true;
        });

        // Agregar el complemento ext-language_tools
        // ace.require("ace/ext/language_tools");

        // Función para ejecutar el código y mostrar "Hola Mundo" en la consola HTML
        function runCode() {
            // Obtiene el código ingresado por el usuario
            var url = "http://34.132.129.84:5000";

            var code = editor.getValue();

            // Realiza una solicitud POST a /pyeval con el código
            $.ajax({
                type: "POST",
                url: url,
                data: JSON.stringify({ "code": code }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",

                success: function (data) {
                    clear_output();
                    // Obtiene el resultado de la clave "result" en data
                    var result = data.result;

                    // Obtiene el valor de la clave "error" en data
                    var error = data.error;

                    // Verifica si hay un resultado y lo muestra
                    // Verifica si hay un resultado y lo muestra
                    if (result) {
                        console.log(result);

                        // Crear un elemento <pre> para el resultado preformateado
                        var preElement = document.createElement("pre");
                        preElement.textContent = result;
                        preElement.classList.remove('dark-theme');
                        preElement.classList.add('light-theme');
                        $("#wrap").append(preElement);
                    }


                    if (error) {
                        // Divide el resultado en párrafos
                        var errors = error.split("\r\n");

                        // Agrega cada párrafo como un nuevo elemento <p> al "wrap"
                        for (var i = 0; i < errors.length; i++) {
                            var nuevoParrafo = document.createElement("p");
                            nuevoParrafo.textContent = errors[i];
                            $("#wrap").append(nuevoParrafo);
                        }
                    }

                    // Supongamos que tienes los datos en una variable llamada data.machine_info
                    var machineInfo = data.machine_info;

                    // Llena los elementos <span> con los datos correspondientes
                    document.getElementById("solicitud-hostname").textContent = machineInfo.hostname;
                    document.getElementById("solicitud-sistema").textContent = machineInfo.system;
                    document.getElementById("solicitud-version").textContent = machineInfo.release;
                    document.getElementById("solicitud-ip").textContent = machineInfo.ip;


                },
                error: function (error) {
                    console.log(error);
                    // Maneja errores si los hay
                    $("#wrap").empty();
                    $("#wrap").text("Error: " + JSON.stringify(error, null, 2));
                }
            });
        }

        function clear_output() {
            $("#wrap").empty();
        }
    </script>
</body>

</html>